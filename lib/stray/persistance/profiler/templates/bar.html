<style type="text/css">
  {% include 'profiler.css' %}
  {% include 'ext/shCoreRDark.css' %}
</style>

<div id="jqueryNotLoaded">
  <p>You must add jquery to enable the profiler</p>
</div>

<div id="stray_profilerWrapper" class="stray_profiler">
  <div id="stray_profilerItems">
    <div class="stray_profilerItem stray_cursor" id="stray_version" onClick="window.open('https://github.com/Nekith/strayFw')">
      <img class="strayUpdateAvailable" src="/media/profiler/icons/refresh.png" />strayFw <span id="strayVersion">{{ PROFILER.fw_version.data.0 }}</span> {{ PROFILER.fw_version_code.data.0 }}
    </div>
    <div class="stray_profilerItem stray_expand">
      <div class="stray_expandWrapper">
        <ul>
          <li>App : <span class="stray_key">{{ PROFILER.app.data.0 }}</span></li>
          <li>Widget : <span class="stray_key">{{ PROFILER.page_widget.data.0 }}</span></li>
          <li>View : <span class="stray_key">{{ PROFILER.page_view.data.0 }}</span></li>
          <hr/>
          <li>
            Routing parameters
            <ul>
              {% if PROFILER.page_params.data != NULL %}
              {% for paramkey, paramvalue in PROFILER.page_params.data %}
              <li class="stray_key">{{ paramkey }} = {{ paramvalue }}</li>
              {% endfor %}
              {% else %}
              <li>None</li>
              {% endif %}
            </ul>
          </li>
          <hr/>
          <li>
            FW plugins
            <ul>
              {% if PROFILER.fw_plugins %}
              {% if app_plugins|length > 0 %}
                {% for plugin in PROFILER.fw_plugins.data %}
                <li class="stray_key">{{ plugin }}</li>
                {% endfor %}
                {% else %}
                <li>No FW plugins</li>
                {% endif %}
              {% endif %}
            </ul>
          </li>
          <li>
            App plugins
            <ul>
              {% if PROFILER.app_plugins %}
                {% if app_plugins|length > 0 %}
                {% for plugin in PROFILER.app_plugins.data %}
                <li class="stray_key">{{ plugin }}</li>
                {% endfor %}
                {% else %}
                <li>No App plugins</li>
                {% endif %}
              {% endif %}
            </ul>
          </li>
        </ul>
      </div>
      <img src="/media/profiler/icons/page.png" alt="" />
      [{{ PROFILER.request_method.data.0 }}] {{ PROFILER.app.data.0 }}::{{ PROFILER.page_widget.data.0 }}:{{ PROFILER.page_view.data.0 }}
      <span class="stray_profilerInfo stray_profiler{% if PROFILER.request_statusCode.data.0 == '200' %}Success{% else %}Error{% endif %}">{{ PROFILER.request_statusCode.data.0 }}</span>
    </div>
    <div class="stray_profilerItem stray_expand">
      <div class="stray_expandWrapper">
        <ul>
          {% for timerkey, timerlog in TIMER %}
          <li class="stray_separator">
            {{ timerkey }} : <span class="stray_key">{{ (timerlog.timestamp*1000)|number_format(3, '.', ',') }}ms / {{ ((timerlog.timestamp/PROFILER.time_elapsed.data.0)*100)|number_format(2, '.', ',') }}%</span>
          </li>
          {% endfor %}
        </ul>
      </div>
      <img src="/media/profiler/icons/time.png" alt="" />
      {{ (PROFILER.time_elapsed.data.0 *1000)|number_format(3, '.', ',') }}<small>ms</small>
    </div>
    <div class="stray_profilerItem">
      <img src="/media/profiler/icons/load.png" alt="" />
      {{ PROFILER.memory_usage.data.0 }}<small>ko</small>
    </div>
    <div class="stray_profilerItem stray_expand">
      <div class="stray_expandWrapper">
        {% if QUERY|length > 0 %}
        <ul>
          {% for queryhost, querylog in QUERY %}
          <li class="stray_separator stray_query">
            <small class="stray_block">[<i>{{ queryhost }}</i> | {{ (querylog.timestamp*1000)|number_format(3, '.', ',') }}ms]</small> 
            <pre class="brush: sql">{{ querylog.data.0 }}</pre>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        No query logs
        {% endif %}
      </div>
      <img src="/media/profiler/icons/database.png" alt="" />
      {% if QUERY|length > 0 %}
      {{ PROFILER.query_count.data.0 }} in {{ (PROFILER.query_time.data.0*1000)|number_format(3, '.', ',') }}ms / {{ ((PROFILER.query_time.data.0/PROFILER.time_elapsed.data.0)*100)|number_format(2, '.', ',') }}%
      {% else %}
      No query logs
      {% endif %}
    </div>
    <div class="stray_profilerItem">
      <img src="/media/profiler/icons/user.png" alt="" />
      WIP
    </div>
    <div class="stray_profilerItem stray_expand" id="stray_ajax">
      <div class="stray_expandWrapper">
        <ul></ul>
      </div>
      <img src="/media/profiler/icons/ajax.png" alt="" />
      <div class="stray_ajaxStatus">
        <span class="stray_ajaxStatusCount">0</span>
        <span class="stray_ajaxStatusSuccess">0</span>
        <span class="stray_ajaxStatusNotfound">0</span>
        <span class="stray_ajaxStatusError">0</span>
      </div>
      <span class="stray_ajaxInfo"></span>
    </div>
    
<!--    <div class="stray_profilerItem stray_profilerItemRight">
      All
    </div>-->
  </div>
  <div style="clear: both"></div>
</div>


<script type="text/javascript">
  {% include 'profiler.js' %}
  {% include 'ext/shCore.js' %}
  {% include 'ext/shBrushSql.js' %}
</script>